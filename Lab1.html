<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 1</title>

<script src="site_libs/header-attrs-2.6/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="site_libs/d3-4.5.0/d3.min.js"></script>
<script src="site_libs/forceNetwork-binding-0.4/forceNetwork.js"></script>
<script src="site_libs/sankey-1/sankey.js"></script>
<script src="site_libs/sankeyNetwork-binding-0.4/sankeyNetwork.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CADMS</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Pre Workshop
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Intro_to_R.html">Intro to R</a>
    </li>
    <li>
      <a href="Spatial_intro.html">Intro to Spatial data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Contact
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Instructors.html">
        <span class="fas fa-users"></span>
         
        Instructors
      </a>
    </li>
    <li>
      <a href="https://cadms.vetmed.ucdavis.edu">
        <span class="fas fa-server"></span>
         
        CADMS Website
      </a>
    </li>
    <li>
      <a href="mailto:jpgo@ucdavis.edu">
        <span class="fas fa-envelope"></span>
         
        Email
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Lab 1</h1>

</div>


<p>Libraries we will use (install if necessary):</p>
<pre class="r"><code>install.packages(&quot;readr&quot;)
install.packages(&quot;igraph&quot;)
install.packages(&quot;dplyr&quot;)
install.packages(&quot;raster&quot;)
install.packages(&quot;scales&quot;)
install.packages(&quot;intergraph&quot;)
install.packages(&quot;network&quot;)
install.packages(&quot;RColorBrewer&quot;)
install.packages(&quot;tidygraph&quot;)</code></pre>
<div id="network-visualization" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Network visualization</h1>
<div id="loading-the-data-and-visualizing-the-network" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Loading the data and visualizing the network</h2>
<pre class="r"><code>library(dplyr)
library(scales)
library(ggplot2)
library(ggraph)
# Libraries for network objects
library(igraph)
library(tidygraph)
# Loading the data from the STNet package
node &lt;- STNet::SwinePrem
edge &lt;- STNet::SwineMov</code></pre>
<p>We use the function <code>graph_from_data_frame()</code> to create the network from a <code>data.frame</code>. This function takes as arguments:<code>d</code> which requires the contacts data, <code>vertices</code> which is the data of the nodes (farms in our example), and <code>directed</code> which specifies if we want to consider the direction of the contact.</p>
<pre class="r"><code># Create the network
net &lt;- graph_from_data_frame(d=edge, vertices=node, directed=T)
# We can examine the contents of the network using the function summary()
summary(net)</code></pre>
<pre><code>## IGRAPH 62b060b DN-- 40 1611 -- 
## + attr: name (v/c), lat (v/n), long (v/n), farm_type (v/c), date (e/c),
## | pigs.moved (e/n), type_orig (e/c), type_dest (e/c)</code></pre>
<p>The result will show a summary of the network. The first line shows that is an object class <code>igraph</code> with 40 nodes and 1611 contacts (edges). Then we have a list of all the attributes of the network. The network attributes can be node attributes (n) or edge attributes (e).<br />
Here we can also see the attribute class:<br />
- <code>c</code> = character.<br />
- <code>n</code> = numeric.</p>
<p>For example, the attribute “name(v/c)” its a node attribute of class character, and the attribute “pigs.moved (e/n)” is an attribute of the edge of class numeric.</p>
<p>To visualize the network we can use the function <code>plot()</code>.</p>
<pre class="r"><code>#plot network#
#for help look look for: ?plot.igraph#
plot(net)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>This figure looks a bit messy, to make it more informative we can visualize dome of the parameters. We use the arguments <code>edge.arrow.size</code> to adjust the size of the arrowhead, <code>vertex.size</code> to adjust the node size, and <code>vertex.label</code> to remove the names of the nodes.</p>
<pre class="r"><code>#make it clearer: adjust size, remove labels#
plot(net, edge.arrow.size=0.2, vertex.size=4, vertex.label=NA)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p><strong>Exercise:</strong> Change the size of the nodes and the arrows to make a different graph.</p>
</div>
<div id="node-color" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> Node color</h2>
<p>We can get specific attributes from the <code>igraph</code> object using <code>V()</code> for nodes, and <code>E()</code> for edges.<br />
The same way we do for a <code>data.frame</code>, we can create new attributes of the network using the <code>$</code> operator and assigning a name to a new variables. Now we will create a new variable for the node color.</p>
<pre class="r"><code># Create a color palette
colpal &lt;- RColorBrewer::brewer.pal(length(levels(node$farm_type)), 
                                   &quot;Dark2&quot;)
colpal &lt;- rainbow(length(levels(node$farm_type)), s = 0.6)
# Assign a new variable for the color:
V(net)$color &lt;- colpal[factor(V(net)$farm_type)]
#plot with colors
#vertex.color assigns colors by calling to the newly created &quot;color&quot; or &quot;color2&quot; variables that are now in the vertex (so node) dimension of the network#
#the vertex dimension is called to by naming it V(net)#
plot(net, edge.arrow.size=0.2, vertex.size=4, vertex.color=V(net)$color, vertex.label=NA)
legend(&quot;bottomleft&quot;, legend = levels(factor(V(net)$farm_type)), col = colpal, pch = 16, bty = &quot;n&quot;)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="layouts" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> Layouts</h2>
<p>We can change the position of the nodes using the argument <code>layout</code>. Now we will use different layouts to see how the network changes.</p>
<pre class="r"><code>#layout_randomly uses a random location
plot(net, edge.arrow.size=0.2, vertex.size=4, vertex.color=V(net)$color, vertex.label=NA, layout=layout_randomly)
legend(&quot;bottomleft&quot;, legend = levels(factor(V(net)$farm_type)), col = colpal, pch = 16, bty = &quot;n&quot;)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Force directed layouts place the nodes in fixed places based on various criteria. The layouts <code>layout_nicely</code> and <code>layout_with_kk</code> force the network in clear layouts, based on the position of the nodes in the network in terms of connectivity. They also attempt to keep the distance between connected nodes fixed.</p>
<pre class="r"><code>par(mfrow = c(1,2))
plot(net, edge.arrow.size=0.2, vertex.size=4, vertex.color=V(net)$color, vertex.label=NA, layout=layout_with_kk)
#the following layouts force nodes to adopt certain shapes#
plot(net, edge.arrow.size=0.2, vertex.size=4, vertex.color=V(net)$color, vertex.label=NA, layout=layout_in_circle)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p><strong>Excercise:</strong> Try different layouts: <code>layout_nicely</code>, <code>layout_with_graphopt</code>, <code>layout_as_star</code>, <code>layout_with_fr</code>, <code>layout_on_grid</code>.</p>
</div>
<div id="size-of-the-edge" class="section level2" number="1.4">
<h2 number="1.4"><span class="header-section-number">1.4</span> Size of the edge</h2>
<pre class="r"><code># We will change the edge size based on the number of aimals moved
E(net)$width &lt;- E(net)$pigs.moved
plot(net, edge.arrow.size=0.2, vertex.size=4, vertex.color=V(net)$color, vertex.label=NA, layout=layout_with_kk)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code># Since the edgge sizes are very large, we will constrain the edge size based on a scale using the package scales
E(net)$width &lt;- scales::rescale(E(net)$pigs.moved, c(0.2, 3))
plot(net, edge.arrow.size=0.2, vertex.size=4, vertex.color=V(net)$color, vertex.label=NA, layout=layout_with_kk)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-9-2.png" width="672" /></p>
</div>
<div id="node-size" class="section level2" number="1.5">
<h2 number="1.5"><span class="header-section-number">1.5</span> Node size</h2>
<p>We will use the indegree value to assign the node size. First we will calculate indegree using the function <code>degree()</code> with the argument <code>mode = "in"</code>, and we will also get rid of the loops.</p>
<pre class="r"><code>#Calculate the indegree
#mode lets you choose between &quot;in&quot;, &quot;out&quot; and &quot;all&quot; for the type of degree
#loops=FALSE removes internal farm shipments
V(net)$indegree &lt;- degree(net,v=V(net),mode=c(&quot;in&quot;), loops=FALSE)
#plot the network by adding the vertex.size argument
plot(net, edge.arrow.size=0.2, vertex.size=V(net)$indegree, vertex.color=V(net)$color, vertex.label=NA, layout=layout_with_kk)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>As you can see, there is one node that receives a lot of movements and you cant really see the edges of the network.</p>
<p><strong>Excercise:</strong> since the node size is too large, rescale the values of the node size so you can see the eddges of the network.</p>
<p>We can also obtain the outdegree using the argument <code>mode = "out"</code> side the function <code>degree()</code>.</p>
<pre class="r"><code>#give weight to node: outdegree#
#same steps with outdegree#
V(net)$outdegree &lt;- degree(net,v=V(net),mode=c(&quot;out&quot;), loops=FALSE)</code></pre>
<p><strong>Excercise:</strong> Now change the node size using the outdegree value.</p>
<pre class="r"><code># Now we will calculate the betweeness and use the network to visualize it
# We use the argument directed=T to consider the directionality of the movement
bet &lt;- betweenness(net, v=V(net), directed=TRUE)
# We make sure that we reascale it so we can see the edges
V(net)$size &lt;- scales::rescale(bet, c(5, 15))
plot(net, edge.arrow.size=0.2, vertex.size=V(net)$size, vertex.color=V(net)$color, vertex.label=NA, layout=layout_with_kk)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
</div>
<div id="using-other-packages-to-plot-the-network" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Using other packages to plot the network</h1>
<p>Besides <code>igraph</code>, there are other packages to plot the network in R. The package <code>network()</code> provides almost the same functions that igraph for plotting, but igraph has more functions for network statistics. To switch between the formats, there is a package calls <code>intergraph()</code> which provides functions to going from an igraph object to a network object and the other way.</p>
<div id="network-package" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> network package</h2>
<p>Here we will use the package <code>network()</code> to plot a network with the names scaled to the number of neighbors.</p>
<pre class="r"><code># First we obtain the number of neighbors for each node
V(net)$nb &lt;- neighborhood.size(net)
# then we switch the format to the network package
G &lt;- intergraph::asNetwork(net)
# Now we plot the network
plot(G, # The name of the network
     displaylabels = T, # We want to show labels
     label.cex = rescale(V(net)$nb, to = c(0.001, 1.5)),# We use the number of neighbors to scale the size
     vertex.cex = 0.001, # Reduce the node size so we dont see it
     arrowhead.cex = 0.001, # reduce the arrowhead size
     label.pos = 5, # the position of label (5 = center)
     edge.col = &quot;lightgreen&quot;) # Edge color</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-13-1.png" width="960" /></p>
</div>
<div id="ggraph" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> ggraph</h2>
<p>Other option for plotting is the package <code>ggraph</code> which uses the same syntax than <code>ggplot</code>.</p>
<pre class="r"><code>net %&gt;%
  as_tbl_graph() %&gt;%
  ggraph(layout = &#39;kk&#39;) +
  geom_edge_link(aes(alpha = pigs.moved)) + # change the transparency based on number of animals moved
  geom_node_point(aes(col = farm_type, size = indegree)) + # size based on indegree
  theme_void()</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="interactive-visualization-using-networkd3" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Interactive visualization using networkD3</h2>
<p>The package <code>networkD3</code> offer some interesting visualization options. This package uses javascript to create interactive visualizations so we need to start our indexing at 0 and not at 1 for the edges. for this we will substract 1 to the edges indexing</p>
<pre class="r"><code># Loading the library
library(networkD3)
# SUbstract 1 from the indexing of the nodes
edge_s &lt;- edge %&gt;%
  count(id_orig, id_dest) %&gt;%
  mutate(id_orig = id_orig - 1, id_dest = id_dest - 1)

# Plot a simple network
simpleNetwork(edge_s)</code></pre>
<div id="htmlwidget-f1d62da57dcf42b2a89a" style="width:672px;height:480px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-f1d62da57dcf42b2a89a">{"x":{"links":{"source":[0,0,0,0,0,12,12,12,23,23,23,23,23,34,35,36,37,37,37,38,38,38,39,2,3,3,3,5,5,5,5,5,7,8,8,8,8,8,8,8,8,8,10,10,10,10,11,11,11,13,13,15,15,15,15,15,16,16,16,16,17,17,17,19,20,20,20,20,21,21,21,21,21,21,22,22,24,24,24,24,24,24,30,31,32,33],"target":[23,39,3,5,14,35,4,9,36,39,3,5,8,35,34,23,36,6,8,36,3,8,3,5,36,37,25,39,3,8,10,18,36,23,36,37,5,10,26,27,28,29,0,23,5,8,34,6,9,37,24,1,6,8,16,17,1,35,6,17,37,6,8,6,0,23,3,24,0,1,36,37,8,22,37,8,0,23,36,37,8,10,8,8,8,8],"value":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"colour":["#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["0","1","10","11","12","13","14","15","16","17","18","19","2","20","21","22","23","24","25","26","27","28","29","3","30","31","32","33","34","35","36","37","38","39","4","5","6","7","8","9"],"group":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"nodesize":[8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8]},"options":{"NodeID":"name","Group":"group","colourScale":"d3.scaleOrdinal(['#3182bd'])","fontSize":7,"fontFamily":"serif","clickTextSize":17.5,"linkDistance":50,"linkWidth":"'1.5px'.toString()","charge":-30,"opacity":0.6,"zoom":false,"legend":false,"arrows":false,"nodesize":true,"radiusCalculation":"d.nodesize","bounded":false,"opacityNoHover":1,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
<p>We can also add more information to our network such as the name, type of node and size of the edges.</p>
<pre class="r"><code># Plot
forceNetwork(Links = edge_s, Nodes = node,
            Source = &quot;id_orig&quot;, Target = &quot;id_dest&quot;,
            Value = &quot;n&quot;, NodeID = &quot;name&quot;,
            Group = &quot;farm_type&quot;, opacity = 0.8)</code></pre>
<div id="htmlwidget-27dee0a94bd9063aa711" style="width:672px;height:480px;" class="forceNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-27dee0a94bd9063aa711">{"x":{"links":{"source":[0,0,0,0,0,2,2,2,3,3,3,3,3,4,5,6,7,7,7,8,8,8,9,10,11,11,11,13,13,13,13,13,15,16,16,16,16,16,16,16,16,16,18,18,18,18,19,19,19,20,20,22,22,22,22,22,23,23,23,23,24,24,24,26,27,27,27,27,28,28,28,28,28,28,29,29,30,30,30,30,30,30,36,37,38,39],"target":[3,9,11,13,21,5,12,17,6,9,11,13,16,5,4,3,6,14,16,6,11,16,11,13,6,7,31,9,11,16,18,25,6,3,6,7,13,18,32,33,34,35,0,3,13,16,4,14,17,7,30,1,14,16,23,24,1,5,14,24,7,14,16,14,0,3,11,30,0,1,6,7,16,29,7,16,0,3,6,7,16,18,16,16,16,16],"value":[21,1,2,5,1,9,2,2,3,5,3,3,1,33,11,3,68,14,1,2,3,1,1,1,2,2,1,1,8,1,4,1,1,5,5,10,13,31,1,1,1,1,4,1,99,293,3,3,21,25,13,12,1,1,2,5,20,5,1,1,120,22,12,1,1,3,4,14,4,1,5,10,468,34,2,10,4,2,30,26,29,10,1,1,1,1],"colour":["#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666","#666"]},"nodes":{"name":["Iowa Select Farms Inc","Stanley Martins Fleckvieh Farms","Centrum Valley Farms","Hilltop Farms fresh produce","Hog Slat Inc.","Safari Iowa Hunting Farms","Kloubec Koi","Johnson Farms Supply","Kroul Farms","Steve Robinson Farm Shop","Loess Hills Lavender Farm","Uncle Bill's Farm","Wild Woods Farm","Western Iowa Farms LLC","Mushroom Mills","Kruger Farms","US Farm Lease","Dawn Golden Farms","Kris Del Farms Corporation","Lapp‰ö_å©'s Bee Supply and Honey Farm LLC","Nelson Pioneer Farm & Museum","WinMor Farms","Armstrong Research Farm","Cinnamon Ridge Farms","Rustik Rooster Farms","Picket Fence Creamery","Doe's and Diva's Dairy, Inc.","Bushman Family Farms Inc","Johnson Farms Inc","Premier Grain","Bethany Farm","Farm Sweet Farm at Rosmann Family Farms","Iowa Farm Family","Iowa State University Horticulture Research Station","RJM Farms Inc","Practical Farmers of Iowa","Bass Farms","A & D Farms Inc","Geno Source","Tatonka Farm"],"group":["sow farm","sow farm","nursery","sow farm","GDU","GDU","GDU","sow farm","nursery","nursery","nursery","nursery","nursery","nursery","finisher","finisher","finisher","finisher","sow farm","finisher","nursery","sow farm","sow farm","sow farm","GDU","sow farm","nursery","nursery","nursery","nursery","GDU","boar stud","sow farm","sow farm","sow farm","sow farm","sow farm","sow farm","sow farm","sow farm"]},"options":{"NodeID":"name","Group":"farm_type","colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":7,"fontFamily":"serif","clickTextSize":17.5,"linkDistance":50,"linkWidth":"function(d) { return Math.sqrt(d.value); }","charge":-30,"opacity":0.8,"zoom":false,"legend":false,"arrows":false,"nodesize":false,"radiusCalculation":" Math.sqrt(d.nodesize)+6","bounded":false,"opacityNoHover":0,"clickAction":null}},"evals":[],"jsHooks":[]}</script>
<p>Another interesting visualization from this package are the Sankey Networks. THis type of visualizations can be very helpful to se the flow of the movements. The height of the rectangles will represent the indegree, and the shaded line between two nodes represent the number of movements between a pair of nodes</p>
<pre class="r"><code># Plot
sankeyNetwork(Links = edge_s, Nodes = node, Source = &quot;id_orig&quot;,
             Target = &quot;id_dest&quot;, Value = &quot;n&quot;, NodeID = &quot;name&quot;,
             fontSize = 12, nodeWidth = 30)</code></pre>
<div id="htmlwidget-8377def8ffd4e48fcb29" style="width:672px;height:480px;" class="sankeyNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-8377def8ffd4e48fcb29">{"x":{"links":{"source":[0,0,0,0,0,2,2,2,3,3,3,3,3,4,5,6,7,7,7,8,8,8,9,10,11,11,11,13,13,13,13,13,15,16,16,16,16,16,16,16,16,16,18,18,18,18,19,19,19,20,20,22,22,22,22,22,23,23,23,23,24,24,24,26,27,27,27,27,28,28,28,28,28,28,29,29,30,30,30,30,30,30,36,37,38,39],"target":[3,9,11,13,21,5,12,17,6,9,11,13,16,5,4,3,6,14,16,6,11,16,11,13,6,7,31,9,11,16,18,25,6,3,6,7,13,18,32,33,34,35,0,3,13,16,4,14,17,7,30,1,14,16,23,24,1,5,14,24,7,14,16,14,0,3,11,30,0,1,6,7,16,29,7,16,0,3,6,7,16,18,16,16,16,16],"value":[21,1,2,5,1,9,2,2,3,5,3,3,1,33,11,3,68,14,1,2,3,1,1,1,2,2,1,1,8,1,4,1,1,5,5,10,13,31,1,1,1,1,4,1,99,293,3,3,21,25,13,12,1,1,2,5,20,5,1,1,120,22,12,1,1,3,4,14,4,1,5,10,468,34,2,10,4,2,30,26,29,10,1,1,1,1]},"nodes":{"name":["Iowa Select Farms Inc","Stanley Martins Fleckvieh Farms","Centrum Valley Farms","Hilltop Farms fresh produce","Hog Slat Inc.","Safari Iowa Hunting Farms","Kloubec Koi","Johnson Farms Supply","Kroul Farms","Steve Robinson Farm Shop","Loess Hills Lavender Farm","Uncle Bill's Farm","Wild Woods Farm","Western Iowa Farms LLC","Mushroom Mills","Kruger Farms","US Farm Lease","Dawn Golden Farms","Kris Del Farms Corporation","Lapp‰ö_å©'s Bee Supply and Honey Farm LLC","Nelson Pioneer Farm & Museum","WinMor Farms","Armstrong Research Farm","Cinnamon Ridge Farms","Rustik Rooster Farms","Picket Fence Creamery","Doe's and Diva's Dairy, Inc.","Bushman Family Farms Inc","Johnson Farms Inc","Premier Grain","Bethany Farm","Farm Sweet Farm at Rosmann Family Farms","Iowa Farm Family","Iowa State University Horticulture Research Station","RJM Farms Inc","Practical Farmers of Iowa","Bass Farms","A & D Farms Inc","Geno Source","Tatonka Farm"],"group":["Iowa Select Farms Inc","Stanley Martins Fleckvieh Farms","Centrum Valley Farms","Hilltop Farms fresh produce","Hog Slat Inc.","Safari Iowa Hunting Farms","Kloubec Koi","Johnson Farms Supply","Kroul Farms","Steve Robinson Farm Shop","Loess Hills Lavender Farm","Uncle Bill's Farm","Wild Woods Farm","Western Iowa Farms LLC","Mushroom Mills","Kruger Farms","US Farm Lease","Dawn Golden Farms","Kris Del Farms Corporation","Lapp‰ö_å©'s Bee Supply and Honey Farm LLC","Nelson Pioneer Farm & Museum","WinMor Farms","Armstrong Research Farm","Cinnamon Ridge Farms","Rustik Rooster Farms","Picket Fence Creamery","Doe's and Diva's Dairy, Inc.","Bushman Family Farms Inc","Johnson Farms Inc","Premier Grain","Bethany Farm","Farm Sweet Farm at Rosmann Family Farms","Iowa Farm Family","Iowa State University Horticulture Research Station","RJM Farms Inc","Practical Farmers of Iowa","Bass Farms","A & D Farms Inc","Geno Source","Tatonka Farm"]},"options":{"NodeID":"name","NodeGroup":"name","LinkGroup":null,"colourScale":"d3.scaleOrdinal(d3.schemeCategory20);","fontSize":12,"fontFamily":null,"nodeWidth":30,"nodePadding":10,"units":"","margin":{"top":null,"right":null,"bottom":null,"left":null},"iterations":32,"sinksRight":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="calculating-euclidean-distance" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Calculating euclidean distance</h1>
<p>We can also use the spatial location of the nodes to calculate the distance between a movement. To represent this distance we use euclidean distance, which is the distance using a straight line between two locations.<br />
We will use the package <code>raster</code> for this part, so make sure its installed.</p>
<pre class="r"><code>library(raster)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## 
## Attaching package: &#39;sp&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggraph&#39;:
## 
##     geometry</code></pre>
<pre><code>## 
## Attaching package: &#39;raster&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:tidygraph&#39;:
## 
##     select</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre class="r"><code># First we need to include the information of origins and destination
edge &lt;- edge %&gt;%
  left_join(node[c(&quot;id&quot;, &quot;lat&quot;, &quot;long&quot;)], by = c(&quot;id_orig&quot; = &quot;id&quot;)) %&gt;%
  rename(O_Lat = lat, O_Long = long) %&gt;%
  left_join(node[c(&quot;id&quot;, &quot;lat&quot;, &quot;long&quot;)], by = c(&quot;id_dest&quot; = &quot;id&quot;)) %&gt;%
  rename(D_Lat = lat, D_Long = long)
# Now we calculate the distance
edge$dist &lt;- pointDistance(p1 = edge[c(&quot;O_Long&quot;, &quot;O_Lat&quot;)], # Origin coordinates
                           p2 = edge[c(&quot;D_Long&quot;, &quot;D_Lat&quot;)], # Destination coordinates
                           lonlat = T)

# We convert from m to km
summary(edge$dist/1000)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   24.55  178.00  229.16  223.15  247.91  472.95</code></pre>
<pre class="r"><code># We can see the quantiles:
quantile(edge$dist/1000, c(0.05,0.95))</code></pre>
<pre><code>##       5%      95% 
## 104.6104 472.9462</code></pre>
<pre class="r"><code># Lets look the distribution of distances
hist(edge$dist/1000, 
     xlim=range(0,500),
     breaks=20,  
     main = &quot;Distribution of euclidean distance (Km)&quot;, xlab=&quot;distance (km)&quot;)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>boxplot(edge$dist/1000,
        ylim=c(0,500),
        main = &quot;Boxlot of euclidean distance (Km)&quot;, ylab=&quot;distance (km)&quot;)</code></pre>
<p><img src="Lab1_files/figure-html/unnamed-chunk-18-2.png" width="672" /></p>
<p>Now we will add the network statistics to the data.frame so we can use them later.</p>
<pre class="r"><code>node &lt;- node %&gt;%
  mutate(indegree = V(net)$indegree, outdegree = V(net)$outdegree, nb = V(net)$nb, Bet = bet)</code></pre>
<p>Finally we will export the network as a RDS file so we can load it in another session.</p>
<pre class="r"><code># we can export the network as a RDS object using the package readr
readr::write_rds(net, &quot;Data/Outputs/net.rds&quot;)
# We will also export the edges with the distance and coordinates
write.csv(edge, &quot;Data/Outputs/edge.csv&quot;, row.names = F)
write.csv(node, &quot;Data/Outputs/node.csv&quot;, row.names = F)</code></pre>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
